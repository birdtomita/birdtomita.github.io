<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>VAD Test</title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
</head>
<body>
    <p id="debugArea">ready</p>
    <p id="devices"></p>
<script type="text/javascript" src="lib/vad.js"></script>
<script type="text/javascript">
    
    const devices = document.getElementByID("devices");
    
    navigator.mediaDevices.enumerateDevices()
.then(function(devices) { // 成功時
 devices.forEach(function(device) {
     const d = document.createElement("div");
     d.innerHTML = JSON.stringify(device);
     p.appendChild(d);
  // デバイスごとの処理
 });
})
.catch(function(err) { // エラー発生時
 console.error('enumerateDevide ERROR:', err);
});

var audioStart = function(){

    if (!navigator || !navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
       alert('Missing support for navigator.mediaDevices.getUserMedia') // temp: helps when testing for strange issues on ios/safari
       return
     }
  
  // Create AudioContext
  window.AudioContext = window.AudioContext || window.webkitAudioContext;
  var audioContext = new AudioContext();

  // Define function called by getUserMedia 
  function startUserMedia(stream) {
    // Create MediaStreamAudioSourceNode
    var source = audioContext.createMediaStreamSource(stream);

    // Setup options
    var options = {
     source: source,
     voice_stop: function() {console.log('voice_stop');document.getElementById('debugArea').innerHTML = 'stop'; }, 
     voice_start: function() {console.log('voice_start'); document.getElementById('debugArea').innerHTML = 'start';}
    }; 
    
    // Create VAD
    var vad = new VAD(options);
  }

  // Ask for audio device
  navigator.mediaDevices.getUserMedia = navigator.mediaDevices.getUserMedia || navigator.getUserMedia || 
                           navigator.mozGetUserMedia || 
                           navigator.webkitGetUserMedia ;
  navigator.mediaDevices.getUserMedia({audio: true}, startUserMedia, function(e) {
          console.log("No live audio input in this browser: " + e);
  });
}

</script>
<button onClick="audioStart()">test</button>
</body>
</html>
