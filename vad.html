<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>VAD Test</title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
</head>
<body>
  <h3>devices</h3>
  <p id="devices"></p>
  <h3>Results</h3>
  <p id="debugArea">ready</p>
  <button id="resume">resume</button>
<script type="text/javascript" src="lib/vad.js"></script>
<script type="text/javascript">
    
    const p = document.getElementById("devices");
    
    navigator.mediaDevices.enumerateDevices()
.then(function(devices) { // 成功時
 devices.forEach(function(device) {
     const d = document.createElement("div");
     d.innerHTML = JSON.stringify(device);
     p.appendChild(d);
  // デバイスごとの処理
 });
})
.catch(function(err) { // エラー発生時
 console.error('enumerateDevide ERROR:', err);
});

const startfunc = function() {
  console.log('start');
  const t = document.createElement("div");
  t.innerHTML = "start";
  document.getElementById('debugArea').appendChild(t);
};
const stopfunc = function() {
  console.log('start');
  const t = document.createElement("div");
  t.innerHTML = "start";
  document.getElementById('debugArea').appendChild(t);
};
  
  // Create AudioContext
  window.AudioContext = window.AudioContext || window.webkitAudioContext;
  var audioContext = new AudioContext();


document.getElementById("resume").onclick = function(){
  if (audioContext.state !== 'running') {
    audioContext.resume();
  }
}

  // Define function called by getUserMedia 
  function startUserMedia(stream) {
    // Create MediaStreamAudioSourceNode
    var source = audioContext.createMediaStreamSource(stream);

    // Setup options
    var options = {
     source: source,
     voice_stop: stopfunc, 
     voice_start: startfunc
    }; 
    
    // Create VAD
    var vad = new VAD(options);
    vad.onMonitor

    if (vad) {
      const d = document.createElement("div");
      d.innerHTML = "vad init";
      document.getElementById('debugArea').appendChild(d);
    } else {
      const d = document.createElement("div");
      d.innerHTML = "vad not defined";
      document.getElementById('debugArea').appendChild(d);
    }

  }

  // Ask for audio device
  navigator.mediaDevices.getUserMedia = navigator.mediaDevices.getUserMedia || navigator.getUserMedia || 
                           navigator.mozGetUserMedia || 
                           navigator.webkitGetUserMedia ;
  navigator.mediaDevices.getUserMedia({audio: true}, startUserMedia, function(e) {
          console.log("No live audio input in this browser: " + e);
  });

</script>
</body>
</html>
